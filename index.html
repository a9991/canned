<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NowNow CS Bot (GPT)</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #121212;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #ff9900;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      font-size: 16px;
      border-radius: 8px;
      border: none;
    }
    .response {
      background: #1e1e1e;
      padding: 16px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      margin-top: 20px;
    }
    .copy-btn {
      background: #ff9900;
      color: #000;
      border: none;
      padding: 8px 12px;
      margin-right: 10px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>NowNow CS GPT Bot</h1>
  <input type="text" id="queryInput" placeholder="Type your question here (EN or AR)...">
  <button onclick="getGPTResponse()">Get Response</button>
  <div id="result" class="response" style="display:none;">
    <p><strong>English:</strong></p>
    <p id="englishResp"></p>
    <button class="copy-btn" onclick="copyToClipboard('englishResp')">Copy EN</button>
    <hr>
    <p><strong>Arabic:</strong></p>
    <p id="arabicResp"></p>
    <button class="copy-btn" onclick="copyToClipboard('arabicResp')">Copy AR</button>
  </div>

  <script>
    let cannedData = [];

    // Load CSV file
    fetch('NowNow_Canned_Responses.csv')
      .then(res => res.text())
      .then(csv => {
        const parsed = Papa.parse(csv, { header: true });
        cannedData = parsed.data;
      });

    async function getGPTResponse() {
      const input = document.getElementById('queryInput').value;
      if (!input) return;

      const messages = [
        {
          role: 'system',
          content: `You are a CS bot. Based on the following canned responses, answer the agent's query. Return one English and one Arabic response. Avoid unnecessary emphasis or overly cheerful intros.
          
          Canned Responses:
          ${cannedData.map(row => `EN: ${row['English']}\nAR: ${row['Arabic']}`).join('\n\n')}`
        },
        {
          role: 'user',
          content: input
        }
      ];

      const res = await fetch('https://api.openai.com/v1/chat/completions', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': 'Bearer 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' // replace before use
        },
        body: JSON.stringify({
          model: 'gpt-4',
          messages: messages,
          temperature: 0.2
        })
      });

      const data = await res.json();
      const reply = data.choices[0].message.content;

      // Simple split for EN and AR based on assumed response format
      const [en, ar] = reply.split(/Arabic\s*[:：]/i);

      document.getElementById('englishResp').innerText = en.replace(/English\s*[:：]/i, '').trim();
      document.getElementById('arabicResp').innerText = (ar || '').trim();
      document.getElementById('result').style.display = 'block';
    }

    function copyToClipboard(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text).then(() => alert('Copied!'));
    }
  </script>
</body>
</html>
